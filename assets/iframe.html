<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <style>
    :root {
      --primary-color: #2952CC;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --success-color: #28a745;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0;
      padding: 16px;
      background: #f5f7f9;
      color: #333;
    }

    .app-container {
      max-width: 350px;
      margin: 0 auto;
    }

    /* Risk Meter Styles */
    .risk-meter {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto 20px;
    }

    .meter {
      width: 100%;
      height: 100%;
    }

    .meter-circle {
      fill: none;
      stroke-width: 10;
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
      transition: stroke-dashoffset 0.5s ease-in-out;
    }

    .meter-background {
      stroke: #e9ecef;
    }

    .meter-value {
      stroke: var(--danger-color);
      stroke-linecap: round;
      stroke-dasharray: 565.48;
      stroke-dashoffset: 565.48;
      transition: stroke-dashoffset 1.5s ease-in-out;
    }

    .score-value, .risk-text {
      fill: #333;
      font-weight: bold;
      text-anchor: middle;
      dominant-baseline: middle;
    }

    /* Risk Section Styles */
    .risk-sections {
      background: white;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .section {
      padding: 15px;
      border-bottom: 1px solid #eaeaea;
    }

    .section:last-child {
      border-bottom: none;
    }

    .section h3 {
      color: #333;
      margin: 0 0 10px 0;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section h3::before {
      content: '';
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: var(--primary-color);
    }

    /* Bullet Point Styles */
    .bullet-point {
      opacity: 0;
      transform: translateX(-20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
      display: flex;
      align-items: center;
      margin: 8px 0;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .bullet-point.loading::before {
      content: '';
      display: inline-block;
      width: 12px;
      height: 12px;
      border: 2px solid currentColor;
      border-right-color: transparent;
      border-radius: 50%;
      margin-right: 8px;
      animation: spin 1.5s linear infinite;
    }

    .bullet-point.show {
      opacity: 1;
      transform: translateX(0);
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .text-yellow-500 { color: #EAB308; }
    .text-red-500 { color: #EF4444; }

    /* Risk Level Indicators */
    .risk-level {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      margin-left: auto;
    }

    .risk-level.high {
      background-color: rgba(220, 53, 69, 0.1);
      color: var(--danger-color);
    }

    .risk-level.medium {
      background-color: rgba(255, 193, 7, 0.1);
      color: var(--warning-color);
    }

    .risk-level.low {
      background-color: rgba(40, 167, 69, 0.1);
      color: var(--success-color);
    }

    /* Deny Button */
    .deny-button {
      display: none;
      width: 100%;
      padding: 12px;
      background-color: var(--danger-color);
      color: white;
      border: none;
      border-radius: 4px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .deny-button:hover {
      background-color: #c82333;
    }

    /* Debug Panel Styles */
    #debugPanel {
      margin-top: 20px;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #dee2e6;
      font-family: monospace;
      font-size: 12px;
    }

    .debug-log {
      margin: 5px 0;
      padding: 5px;
      border-bottom: 1px solid #eee;
    }
  </style>
</head>
<body>
  <div id="app" class="app-container">
    <!-- Risk Widget -->
    <div class="risk-widget">
      <!-- Risk Meter -->
      <div class="risk-meter">
        <svg class="meter" viewBox="0 0 200 200">
          <circle class="meter-circle meter-background" cx="100" cy="100" r="90"/>
          <circle class="meter-circle meter-value" cx="100" cy="100" r="90"/>
          <text class="score-value" x="100" y="90" style="font-size: 24px;">0%</text>
          <text class="risk-text" x="100" y="120" style="font-size: 16px;">Low Risk</text>
        </svg>
      </div>

      <!-- Risk Summary Sections -->
      <div class="risk-sections">
        <div id="identity-section" class="section">
          <h3>Identity/KYC</h3>
          <ul class="bullet-list"></ul>
        </div>
        <div id="conversation-section" class="section">
          <h3>Conversation Behavior</h3>
          <ul class="bullet-list"></ul>
        </div>
        <div id="delivery-section" class="section">
          <h3>Proof of Delivery</h3>
          <ul class="bullet-list"></ul>
        </div>
      </div>

      <!-- Deny Button -->
      <button id="denyButton" class="deny-button">
        Deny Claim
      </button>
    </div>

    <!-- Debug Panel -->
    <div id="debugPanel">
      <div class="debug-header">
        <strong>Debug Information</strong>
      </div>
      <div class="debug-content">
        <div>
          <strong>Status:</strong> <span id="widgetStatus">Initializing...</span>
        </div>
        <div>
          <strong>Current Score:</strong> <span id="currentScore">0%</span>
        </div>
        <div>
          <strong>Events Monitored:</strong> <span id="eventsMonitored">0</span>
        </div>
      </div>
      <div id="debugLog" class="mt-2"></div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Enable CORS for ZAF client
    window.addEventListener('error', function(e) {
      if (e.message.includes('cross-origin')) {
        console.warn('Cross-origin error handled:', e.message);
        return true;
      }
    });
  </script>
  <script src="https://static.zdassets.com/zendesk_app_framework_sdk/2.0/zaf_sdk.min.js"></script>
  <script src="../scripts/app.js"></script>
</body>
</html>